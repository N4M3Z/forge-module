# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

> `CLAUDE.md` and `AGENTS.md` are autogenerated by `/Init`. Do not edit directly -- run `/Update` to regenerate.

## What This Is

forge-module is a template for creating forge modules -- plugins that teach AI coding assistants your project's conventions. Ships with one example agent (ExampleAgent), one example skill (ExampleConventions), and multi-provider deployment via forge-lib. Clone, rename, customize.

## Install / Verify

```bash
make install          # deploy agent + skill (Claude, Gemini, Codex, OpenCode)
make verify           # check agent deployed + skill present
make test             # run module validation (validate-module)
make clean            # remove previously installed agents
make lint             # shellcheck all scripts
```

Standalone agent deployment without Make:

```bash
lib/bin/install-agents agents              # install agent
lib/bin/install-agents agents --dry-run    # preview
lib/bin/install-agents agents --clean      # clean + reinstall
```

## Architecture

```
agents/               1 example agent (ExampleAgent.md)
skills/               1 example skill (ExampleConventions/)
lib/                  git submodule -> forge-lib (Rust binaries for deployment + validation)
defaults.yaml         agent roster + skill config + provider models
config.yaml           user overrides (gitignored), same structure as defaults
module.yaml           module metadata (name, version)
.claude-plugin/       plugin.json manifest for Claude Code plugin discovery
.claude/              generated by `make install` (gitignored, .gitkeep only)
.gemini/              generated by `make install` (gitignored, .gitkeep only)
.codex/               generated by `make install` (gitignored, .gitkeep only)
.opencode/            generated by `make install` (gitignored, .gitkeep only)
```

Platform directories (`.claude/`, `.gemini/`, `.codex/`, `.opencode/`) contain deployed agents and skills generated by `make install`. They are gitignored -- never edit directly. Source of truth is `agents/`, `skills/`, and `defaults.yaml`.

### Agent Files (`agents/*.md`)

YAML frontmatter with required keys: `name` (PascalCase, matches filename), `description` (pattern: `"Role -- capabilities. USE WHEN triggers."`), `version`.

Deployment config (model, tools, scope) lives in `defaults.yaml`, not in agent frontmatter. Agent files contain only identity (name, description, version) and body instructions.

Body structure in order: blockquote summary (ends with "Shipped with forge-module."), `## Role`, `## Expertise`, `## Instructions`, `## Output Format`, `## Constraints`.

### Skill Files (`skills/*/SKILL.md` + `SKILL.yaml`)

`SKILL.md` contains the skill instructions. `SKILL.yaml` contains metadata and provider routing (`claude`, `gemini`, `codex`).

### Configuration

- `defaults.yaml`: canonical roster -- edit when adding/removing agents or changing models
- `config.yaml`: user overrides (gitignored) -- same structure, only changed fields
- `module.yaml`: module metadata -- update `version` on releases

Model tiers and tool assignments live in `defaults.yaml`. Override per-agent with `config.yaml`.

## Conventions

### Naming

| Context | Convention |
|---------|-----------|
| Agent filenames / name | PascalCase (`ExampleAgent.md`) |
| Skill directories | PascalCase (`ExampleConventions/`) |
| YAML keys | lowercase |

### Git

Conventional Commits: `type: description`. Lowercase, no trailing period, no scope. Types: `feat`, `fix`, `docs`.

## Modification Workflows

**Add agent**: Create `agents/Name.md` with frontmatter + structured body -> add to `defaults.yaml` roster -> `lib/bin/install-agents agents --dry-run` -> commit `feat: add Name for [domain]`.

**Modify skill**: Edit `skills/Name/SKILL.md` + `SKILL.yaml` -> test by invoking the skill -> commit.

**Update model/tools**: Edit `defaults.yaml` (or `config.yaml` override) -> `lib/bin/install-agents agents --clean` -> restart session.
